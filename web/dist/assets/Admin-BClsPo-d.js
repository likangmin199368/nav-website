var J=Object.defineProperty,Q=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var E=(C,s,u)=>s in C?J(C,s,{enumerable:!0,configurable:!0,writable:!0,value:u}):C[s]=u,P=(C,s)=>{for(var u in s||(s={}))Y.call(s,u)&&E(C,u,s[u]);if(D)for(var u of D(s))Z.call(s,u)&&E(C,u,s[u]);return C},R=(C,s)=>Q(C,X(s));var y=(C,s,u)=>new Promise((a,c)=>{var v=m=>{try{d(u.next(m))}catch(w){c(w)}},b=m=>{try{d(u.throw(m))}catch(w){c(w)}},d=m=>m.done?a(m.value):Promise.resolve(m.value).then(v,b);d((u=u.apply(C,s)).next())});import{_ as j,r as p,h as z,c as _,o as g,b as e,j as f,v as k,l as T,F as L,a as A,n as I,t as U,g as q,w as O,p as N,m as W,d as B,q as H,k as K,s as ee,u as F}from"./index-DECnA1Y4.js";import{a as G,f as te,u as le,h as ne,i as se,j as oe,k as ae,l as ie,m as ue,n as de,d as re,b as ce,o as ve,p as pe,q as me,c as ge,r as be,s as he,t as fe,v as _e,w as we,x as ke,y as $e,g as ye,z as Me,A as Ce}from"./api-CPdfUet4.js";const Ue={class:"menu-manage"},Ve={class:"menu-header"},xe={class:"menu-add"},Be={class:"menu-content"},Se={class:"menu-list"},Ie={class:"main-menu"},Le={class:"menu-info"},Ae=["onUpdate:modelValue","onBlur"],je={class:"menu-order"},Fe=["onUpdate:modelValue","onBlur"],Te={class:"menu-actions"},ze=["onClick","title"],Pe=["onClick"],He={class:"sub-menu-header"},Re={class:"sub-menu-title"},Ne=["onClick"],De={key:0,class:"sub-menu-list"},Ee={class:"sub-menu-info"},Oe=["onUpdate:modelValue","onBlur"],Ke={class:"sub-menu-order"},qe=["onUpdate:modelValue","onBlur"],We={class:"sub-menu-actions"},Ge=["onClick"],Je={key:1,class:"empty-sub-menu"},Qe=["onClick"],Xe={__name:"MenuManage",setup(C){const s=p([]),u=p("");z(a);function a(){return y(this,null,function*(){const t=yield G();s.value=t.data.map(l=>R(P({},l),{showSubMenu:!1}))})}function c(){return y(this,null,function*(){if(!u.value.trim())return;const t=s.value.length?Math.max(...s.value.map(l=>l.order||0)):0;yield te({name:u.value.trim(),order:t+1}),u.value="",a()})}function v(t){return y(this,null,function*(){yield le(t.id,{name:t.name,order:t.order}),a()})}function b(t){return y(this,null,function*(){confirm("确定要删除这个主菜单吗？删除后将同时删除其下的所有子菜单和卡片。")&&(yield ne(t),a())})}function d(t){return y(this,null,function*(){var $;const l=s.value.find(M=>M.id===t),o=prompt("请输入子菜单名称：");if(!(o!=null&&o.trim()))return;const x=($=l.subMenus)!=null&&$.length?Math.max(...l.subMenus.map(M=>M.order||0)):0;yield se(t,{name:o.trim(),order:x+1}),a()})}function m(t){return y(this,null,function*(){yield oe(t.id,{name:t.name,order:t.order}),a()})}function w(t){return y(this,null,function*(){confirm("确定要删除这个子菜单吗？删除后将同时删除其下的所有卡片。")&&(yield ae(t),a())})}function r(t){const l=s.value.find(o=>o.id===t);l&&(l.showSubMenu=!l.showSubMenu)}return(t,l)=>(g(),_("div",Ue,[e("div",Ve,[l[2]||(l[2]=e("div",{class:"header-content"},[e("h2",{class:"page-title"},"管理主菜单和子菜单")],-1)),e("div",xe,[f(e("input",{"onUpdate:modelValue":l[0]||(l[0]=o=>u.value=o),placeholder:"请输入主菜单名称",class:"input"},null,512),[[k,u.value]]),e("button",{class:"btn btn-primary",onClick:c},l[1]||(l[1]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 5v14M5 12h14"})],-1),T(" 添加主菜单 ")]))])]),e("div",Be,[e("div",Se,[(g(!0),_(L,null,A(s.value,o=>{var x;return g(),_("div",{key:o.id,class:"menu-item"},[e("div",Ie,[e("div",Le,[l[4]||(l[4]=e("div",{class:"menu-icon"},[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 3h18v18H3zM9 9h6v6H9z"})])],-1)),f(e("input",{"onUpdate:modelValue":$=>o.name=$,onBlur:$=>v(o),class:"menu-name-input"},null,40,Ae),[[k,o.name]]),e("div",je,[l[3]||(l[3]=e("span",{class:"order-label"},"排序",-1)),f(e("input",{"onUpdate:modelValue":$=>o.order=$,type:"number",onBlur:$=>v(o),class:"order-input"},null,40,Fe),[[k,o.order,void 0,{number:!0}]])])]),e("div",Te,[e("button",{class:"btn btn-icon expand-btn",onClick:$=>r(o.id),title:o.showSubMenu?"收起子菜单":"展开子菜单"},l[5]||(l[5]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"m6 9 6 6 6-6"})],-1)]),8,ze),e("button",{class:"btn btn-danger btn-icon",onClick:$=>b(o.id),title:"删除主菜单"},l[6]||(l[6]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),e("path",{d:"M10 11v6M14 11v6"})],-1)]),8,Pe)])]),e("div",{class:I(["sub-menu-section",{expanded:o.showSubMenu}])},[e("div",He,[e("div",Re,[l[7]||(l[7]=e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M9 11H1l8-8 8 8h-8v8z"})],-1)),T(" 子菜单 ("+U(((x=o.subMenus)==null?void 0:x.length)||0)+") ",1)]),e("button",{class:"btn btn-sm btn-outline",onClick:$=>d(o.id)},l[8]||(l[8]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 5v14M5 12h14"})],-1),T(" 添加子菜单 ")]),8,Ne)]),o.subMenus&&o.subMenus.length>0?(g(),_("div",De,[(g(!0),_(L,null,A(o.subMenus,$=>(g(),_("div",{key:$.id,class:"sub-menu-item"},[e("div",Ee,[l[9]||(l[9]=e("div",{class:"sub-menu-icon"},[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M4 6h16M4 12h16M4 18h16"})])],-1)),f(e("input",{"onUpdate:modelValue":M=>$.name=M,onBlur:M=>m($),class:"sub-menu-name-input"},null,40,Oe),[[k,$.name]]),e("div",Ke,[f(e("input",{"onUpdate:modelValue":M=>$.order=M,type:"number",onBlur:M=>m($),class:"order-input"},null,40,qe),[[k,$.order,void 0,{number:!0}]])])]),e("div",We,[e("button",{class:"btn btn-danger btn-icon btn-sm",onClick:M=>w($.id),title:"删除子菜单"},l[10]||(l[10]=[e("svg",{width:"14",height:"14",viewBox:"0 0 22 22",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),e("path",{d:"M10 11v6M14 11v6"})],-1)]),8,Ge)])]))),128))])):(g(),_("div",Je,[l[11]||(l[11]=e("p",null,"暂无子菜单",-1)),e("button",{class:"btn btn-sm btn-outline",onClick:$=>d(o.id)},"添加第一个子菜单",8,Qe)]))],2)])}),128))])])]))}},Ye=j(Xe,[["__scopeId","data-v-5964fa59"]]),Ze={class:"card-manage"},et={class:"card-header"},tt={class:"card-add"},lt=["value"],nt=["value"],st={class:"input-with-icon"},ot={class:"card-card"},at={class:"card-table"},it=["onUpdate:modelValue","onBlur"],ut=["onUpdate:modelValue","onBlur"],dt={class:"input-with-icon"},rt=["onUpdate:modelValue","onBlur"],ct=["onClick"],vt=["onUpdate:modelValue","onBlur"],pt=["onUpdate:modelValue","onBlur"],mt=["onClick"],gt={__name:"CardManage",setup(C){const s=p([]),u=p([]),a=p(),c=p(""),v=p(""),b=p(""),d=p(""),m=q(()=>{if(!a.value)return[];const h=s.value.find(n=>n.id===a.value);return(h==null?void 0:h.subMenus)||[]});z(()=>y(null,null,function*(){const h=yield G();s.value=h.data,s.value.length&&(a.value=s.value[0].id,c.value="")})),O(a,()=>{c.value="",t()}),O(c,t);function w(){c.value=""}function r(){t()}function t(){return y(this,null,function*(){if(!a.value)return;const h=yield re(a.value,c.value||null);u.value=h.data})}function l(){return y(this,null,function*(){!v.value||!b.value||(yield ie({menu_id:a.value,sub_menu_id:c.value||null,title:v.value,url:b.value,logo_url:d.value}),v.value="",b.value="",d.value="",t())})}function o(h){return y(this,null,function*(){yield ue(h.id,{menu_id:a.value,sub_menu_id:c.value||null,title:h.title,url:h.url,logo_url:h.logo_url,desc:h.desc,order:h.order})})}function x(h){return y(this,null,function*(){yield de(h),t()})}function $(h){if(!h)return null;try{let n=h;return/^https?:\/\//i.test(n)||(n="http://"+n),new URL(n).hostname.replace(/^www\./i,"")}catch(n){return console.error("URL 格式无效: ",n),null}}function M(){const h=$(b.value);h?d.value=`https://www.faviconextractor.com/favicon/${h}?larger=true`:alert("请先在“卡片链接”中输入有效的 URL")}function S(h){return y(this,null,function*(){const n=$(h.url);if(n){h.logo_url=`https://www.faviconextractor.com/favicon/${n}?larger=true`;try{yield o(h)}catch(i){console.error("自动保存图标失败:",i),alert("获取图标成功，但自动保存失败。请稍后重试或手动编辑保存。")}}else alert("此卡片的 URL 无效，无法获取图标。")})}return(h,n)=>(g(),_("div",Ze,[e("div",et,[n[8]||(n[8]=e("div",{class:"header-content"},[e("h2",{class:"page-title"},"管理网站导航卡片，支持主菜单和子菜单分类")],-1)),e("div",tt,[f(e("select",{"onUpdate:modelValue":n[0]||(n[0]=i=>a.value=i),class:"input narrow",onChange:w},[(g(!0),_(L,null,A(s.value,i=>(g(),_("option",{value:i.id,key:i.id},U(i.name),9,lt))),128))],544),[[N,a.value]]),f(e("select",{"onUpdate:modelValue":n[1]||(n[1]=i=>c.value=i),class:"input narrow",onChange:r},[n[5]||(n[5]=e("option",{value:""},"主菜单",-1)),(g(!0),_(L,null,A(m.value,i=>(g(),_("option",{value:i.id,key:i.id},U(i.name),9,nt))),128))],544),[[N,c.value]]),f(e("input",{"onUpdate:modelValue":n[2]||(n[2]=i=>v.value=i),placeholder:"卡片标题",class:"input narrow"},null,512),[[k,v.value]]),f(e("input",{"onUpdate:modelValue":n[3]||(n[3]=i=>b.value=i),placeholder:"卡片链接",class:"input wide"},null,512),[[k,b.value]]),e("div",st,[f(e("input",{"onUpdate:modelValue":n[4]||(n[4]=i=>d.value=i),placeholder:"logo链接(可选)",class:"input wide"},null,512),[[k,d.value]]),e("button",{class:"btn btn-icon btn-magic",onClick:M,title:"自动获取图标"},n[6]||(n[6]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M9.9 2.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3L7.5 10.5l.5-2.8-2.1-2 2.9-.4zM18.5 10.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3-2.5 1.3.5-2.8-2.1-2 2.9-.4zM10 15.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3-2.5 1.3.5-2.8-2.1-2 2.9-.4z"})],-1)]))]),e("button",{class:"btn",onClick:l},n[7]||(n[7]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 5v14M5 12h14"})],-1),T(" 添加卡片 ")]))])]),e("div",ot,[e("table",at,[n[11]||(n[11]=e("thead",null,[e("tr",null,[e("th",null,"标题"),e("th",null,"网址"),e("th",null,"Logo链接"),e("th",null,"描述"),e("th",null,"排序"),e("th",null,"操作")])],-1)),e("tbody",null,[(g(!0),_(L,null,A(u.value,i=>(g(),_("tr",{key:i.id},[e("td",null,[f(e("input",{"onUpdate:modelValue":V=>i.title=V,onBlur:V=>o(i),class:"table-input"},null,40,it),[[k,i.title]])]),e("td",null,[f(e("input",{"onUpdate:modelValue":V=>i.url=V,onBlur:V=>o(i),class:"table-input"},null,40,ut),[[k,i.url]])]),e("td",null,[e("div",dt,[f(e("input",{"onUpdate:modelValue":V=>i.logo_url=V,onBlur:V=>o(i),class:"table-input",placeholder:"logo链接(可选)"},null,40,rt),[[k,i.logo_url]]),e("button",{class:"btn btn-icon btn-magic",onClick:V=>S(i),title:"自动获取图标"},n[9]||(n[9]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M9.9 2.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3L7.5 10.5l.5-2.8-2.1-2 2.9-.4zM18.5 10.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3-2.5 1.3.5-2.8-2.1-2 2.9-.4zM10 15.5l1.1 2.8 2.9.4-2.1 2 .5 2.8-2.5-1.3-2.5 1.3.5-2.8-2.1-2 2.9-.4z"})],-1)]),8,ct)])]),e("td",null,[f(e("input",{"onUpdate:modelValue":V=>i.desc=V,onBlur:V=>o(i),class:"table-input",placeholder:"描述（可选）"},null,40,vt),[[k,i.desc]])]),e("td",null,[f(e("input",{"onUpdate:modelValue":V=>i.order=V,type:"number",onBlur:V=>o(i),class:"table-input order-input"},null,40,pt),[[k,i.order,void 0,{number:!0}]])]),e("td",null,[e("button",{class:"btn btn-danger btn-icon",onClick:V=>x(i.id),title:"删除"},n[10]||(n[10]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),e("path",{d:"M10 11v6M14 11v6"})],-1)]),8,mt)])]))),128))])])])]))}},bt=j(gt,[["__scopeId","data-v-fe88d5ed"]]),ht={class:"ad-manage"},ft={class:"ad-header"},_t={class:"ad-section"},wt={class:"ad-card"},kt={class:"ad-table"},$t=["onUpdate:modelValue","onBlur"],yt=["onUpdate:modelValue","onBlur"],Mt=["onClick"],Ct={class:"ad-section"},Ut={class:"ad-card"},Vt={class:"ad-table"},xt=["onUpdate:modelValue","onBlur"],Bt=["onUpdate:modelValue","onBlur"],St=["onClick"],It={__name:"AdManage",setup(C){const s=p([]),u=p([]),a=p(""),c=p(""),v=p("left");z(b);function b(){return y(this,null,function*(){const r=yield ce();s.value=r.data.filter(t=>t.position==="left"),u.value=r.data.filter(t=>t.position==="right")})}function d(){return y(this,null,function*(){!a.value||!c.value||(yield ve({position:v.value,img:a.value,url:c.value}),a.value="",c.value="",v.value="left",b())})}function m(r){return y(this,null,function*(){yield pe(r.id,{img:r.img,url:r.url}),b()})}function w(r){return y(this,null,function*(){yield me(r),b()})}return(r,t)=>(g(),_("div",ht,[e("div",ft,[e("form",{class:"ad-add-row",onSubmit:W(d,["prevent"])},[f(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>a.value=l),placeholder:"广告图片链接",class:"input"},null,512),[[k,a.value]]),f(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>c.value=l),placeholder:"广告跳转链接",class:"input"},null,512),[[k,c.value]]),f(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>v.value=l),class:"input select-input"},t[3]||(t[3]=[e("option",{value:"left"},"左侧广告",-1),e("option",{value:"right"},"右侧广告",-1)]),512),[[N,v.value]]),t[4]||(t[4]=e("button",{class:"btn",type:"submit"},"添加广告",-1))],32)]),e("div",_t,[t[6]||(t[6]=e("h3",{class:"section-title"},"左侧广告列表",-1)),e("div",wt,[e("table",kt,[t[5]||(t[5]=e("thead",null,[e("tr",null,[e("th",null,"图片"),e("th",null,"跳转链接"),e("th",null,"操作")])],-1)),e("tbody",null,[(g(!0),_(L,null,A(s.value,l=>(g(),_("tr",{key:l.id},[e("td",null,[f(e("input",{"onUpdate:modelValue":o=>l.img=o,onBlur:o=>m(l),class:"input"},null,40,$t),[[k,l.img]])]),e("td",null,[f(e("input",{"onUpdate:modelValue":o=>l.url=o,onBlur:o=>m(l),class:"input"},null,40,yt),[[k,l.url]])]),e("td",null,[e("button",{class:"btn btn-danger",onClick:o=>w(l.id)},"删除广告",8,Mt)])]))),128))])])])]),e("div",Ct,[t[8]||(t[8]=e("h3",{class:"section-title"},"右侧广告列表",-1)),e("div",Ut,[e("table",Vt,[t[7]||(t[7]=e("thead",null,[e("tr",null,[e("th",null,"图片"),e("th",null,"跳转链接"),e("th",null,"操作")])],-1)),e("tbody",null,[(g(!0),_(L,null,A(u.value,l=>(g(),_("tr",{key:l.id},[e("td",null,[f(e("input",{"onUpdate:modelValue":o=>l.img=o,onBlur:o=>m(l),class:"input"},null,40,xt),[[k,l.img]])]),e("td",null,[f(e("input",{"onUpdate:modelValue":o=>l.url=o,onBlur:o=>m(l),class:"input"},null,40,Bt),[[k,l.url]])]),e("td",null,[e("button",{class:"btn btn-danger",onClick:o=>w(l.id)},"删除广告",8,St)])]))),128))])])])])]))}},Lt=j(It,[["__scopeId","data-v-780b5e23"]]),At={class:"friend-manage"},jt={class:"friend-add"},Ft={class:"friend-card"},Tt={class:"friend-table"},zt=["onUpdate:modelValue","onBlur"],Pt=["onUpdate:modelValue","onBlur"],Ht=["onUpdate:modelValue","onBlur"],Rt=["onClick"],Nt={__name:"FriendLinkManage",setup(C){const s=p([]),u=p(""),a=p(""),c=p("");z(v);function v(){return y(this,null,function*(){const w=yield ge();s.value=w.data})}function b(){return y(this,null,function*(){!u.value||!a.value||(yield be({title:u.value,url:a.value,logo:c.value}),u.value="",a.value="",c.value="",v())})}function d(w){return y(this,null,function*(){yield he(w.id,{title:w.title,url:w.url,logo:w.logo}),v()})}function m(w){return y(this,null,function*(){yield fe(w),v()})}return(w,r)=>(g(),_("div",At,[r[4]||(r[4]=e("div",{class:"friend-header"},null,-1)),e("div",jt,[f(e("input",{"onUpdate:modelValue":r[0]||(r[0]=t=>u.value=t),placeholder:"网站名",class:"input"},null,512),[[k,u.value]]),f(e("input",{"onUpdate:modelValue":r[1]||(r[1]=t=>a.value=t),placeholder:"网站链接",class:"input"},null,512),[[k,a.value]]),f(e("input",{"onUpdate:modelValue":r[2]||(r[2]=t=>c.value=t),placeholder:"logo链接(可选)",class:"input"},null,512),[[k,c.value]]),e("button",{class:"btn",onClick:b},"添加友链")]),e("div",Ft,[e("table",Tt,[r[3]||(r[3]=e("thead",null,[e("tr",null,[e("th",null,"网站名"),e("th",null,"链接"),e("th",null,"Logo"),e("th",null,"操作")])],-1)),e("tbody",null,[(g(!0),_(L,null,A(s.value,t=>(g(),_("tr",{key:t.id},[e("td",null,[f(e("input",{"onUpdate:modelValue":l=>t.title=l,onBlur:l=>d(t),class:"input"},null,40,zt),[[k,t.title]])]),e("td",null,[f(e("input",{"onUpdate:modelValue":l=>t.url=l,onBlur:l=>d(t),class:"input"},null,40,Pt),[[k,t.url]])]),e("td",null,[f(e("input",{"onUpdate:modelValue":l=>t.logo=l,onBlur:l=>d(t),class:"input",placeholder:"logo链接(可选)"},null,40,Ht),[[k,t.logo]])]),e("td",null,[e("button",{class:"btn btn-danger",onClick:l=>m(t.id)},"删除",8,Rt)])]))),128))])])])]))}},Dt=j(Nt,[["__scopeId","data-v-f280329a"]]),Et={class:"user-manage"},Ot={class:"user-card"},Kt={class:"password-section"},qt={class:"password-form"},Wt={class:"form-group"},Gt={class:"form-group"},Jt={class:"form-group"},Qt={class:"form-actions"},Xt=["disabled"],Yt={__name:"UserManage",setup(C){const s=p(""),u=p(""),a=p(""),c=p(!1),v=p(""),b=p("success"),d=p({});z(()=>y(null,null,function*(){try{const r=yield _e();d.value=r.data}catch(r){console.error("获取用户信息失败:",r)}}));function m(){return y(this,null,function*(){var r,t;if(!s.value||!u.value||!a.value){w("请填写所有密码字段","error");return}if(u.value!==a.value){w("两次输入的新密码不一致","error");return}if(u.value.length<6){w("新密码长度至少6位","error");return}c.value=!0,v.value="";try{yield we(s.value,u.value),w("密码修改成功","success"),s.value="",u.value="",a.value=""}catch(l){w(((t=(r=l.response)==null?void 0:r.data)==null?void 0:t.message)||"密码修改失败","error")}finally{c.value=!1}})}function w(r,t){v.value=r,b.value=t,r==="密码修改成功"&&t==="success"?setTimeout(()=>{v.value="2秒后自动退出登录,请使用新密码重新登录...",setTimeout(()=>{localStorage.removeItem("token"),window.location.reload()},2e3)},500):setTimeout(()=>{v.value=""},3e3)}return(r,t)=>(g(),_("div",Et,[t[7]||(t[7]=e("div",{class:"user-header"},null,-1)),e("div",Ot,[e("div",Kt,[t[6]||(t[6]=e("h3",{class:"section-title"},"修改密码",-1)),e("div",qt,[e("div",Wt,[t[3]||(t[3]=e("label",null,"当前密码：",-1)),f(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>s.value=l),type:"password",placeholder:"请输入当前密码",class:"input"},null,512),[[k,s.value]])]),e("div",Gt,[t[4]||(t[4]=e("label",null,"新密码：",-1)),f(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>u.value=l),type:"password",placeholder:"请输入新密码",class:"input"},null,512),[[k,u.value]])]),e("div",Jt,[t[5]||(t[5]=e("label",null,"确认新密码：",-1)),f(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>a.value=l),type:"password",placeholder:"请再次输入新密码",class:"input"},null,512),[[k,a.value]])]),e("div",Qt,[e("button",{onClick:m,class:"btn",disabled:c.value},U(c.value?"修改中...":"修改密码"),9,Xt)]),v.value?(g(),_("p",{key:0,class:I(["message",b.value])},U(v.value),3)):B("",!0)])])])]))}},Zt=j(Yt,[["__scopeId","data-v-85ce40f4"]]),el={class:"backup-manage"},tl={class:"backup-card"},ll=["disabled"],nl={class:"backup-card import-card"},sl={class:"import-controls"},ol=["disabled"],al={key:0,class:"file-name"},il={__name:"BackupManage",setup(C){const s=p(!1),u=p(!1),a=p(null),c=p(null),v=p(""),b=p("success");function d(){return y(this,null,function*(){var r,t;s.value=!0,v.value="";try{const l=yield ke(),o=l.headers["content-disposition"];let x="nav-backup.json";if(o){const h=o.split(";").find(n=>n.trim().startsWith("filename="));h&&(x=h.split("=")[1].trim().replace(/"/g,""))}const $=window.URL.createObjectURL(new Blob([l.data])),M=document.createElement("a");M.href=$,M.setAttribute("download",x),document.body.appendChild(M),M.click(),document.body.removeChild(M),window.URL.revokeObjectURL($),v.value="导出成功！",b.value="success"}catch(l){console.error("导出失败:",l),v.value="导出失败: "+(((t=(r=l.response)==null?void 0:r.data)==null?void 0:t.error)||l.message),b.value="error"}finally{s.value=!1}})}function m(r){a.value=r.target.files[0]||null,v.value=""}function w(){return y(this,null,function*(){var t,l;if(!a.value){alert("请先选择一个 .json 备份文件。");return}if(prompt(`这是一个极度危险的操作，将清空所有数据！

请输入 "确认导入" 来继续：`)!=="确认导入"){alert("操作已取消。");return}u.value=!0,v.value="正在导入...",b.value="success";try{const o=new FormData;o.append("backupFile",a.value);const x=yield $e(o);v.value=x.data.message||"导入成功！请刷新页面查看新数据。",b.value="success",a.value=null,c.value&&(c.value.value=""),alert("导入成功！您的所有数据已被覆盖。建议您刷新整个后台页面。")}catch(o){console.error("导入失败:",o),v.value="导入失败: "+(((l=(t=o.response)==null?void 0:t.data)==null?void 0:l.error)||o.message),b.value="error"}finally{u.value=!1}})}return(r,t)=>(g(),_("div",el,[e("div",tl,[t[0]||(t[0]=H('<h2 class="card-title" data-v-bc34ad5f><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#2566d8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-bc34ad5f><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" data-v-bc34ad5f></path><polyline points="7 10 12 15 17 10" data-v-bc34ad5f></polyline><line x1="12" y1="15" x2="12" y2="3" data-v-bc34ad5f></line></svg> 导出备份 </h2><p class="card-desc" data-v-bc34ad5f> 点击下面的按钮，将您当前的所有数据（包括栏目、卡片、用户、广告和友链）下载为一个 `backup.json` 文件。 请妥善保管这个文件。 </p>',2)),e("button",{class:"btn",onClick:d,disabled:s.value},U(s.value?"正在导出...":"导出现有数据"),9,ll)]),e("div",nl,[t[1]||(t[1]=H('<h2 class="card-title" data-v-bc34ad5f><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#e74c3c" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-bc34ad5f><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" data-v-bc34ad5f></path><polyline points="7 10 12 5 17 10" data-v-bc34ad5f></polyline><line x1="12" y1="5" x2="12" y2="21" data-v-bc34ad5f></line></svg> 导入备份 (危险操作) </h2><p class="card-desc warning" data-v-bc34ad5f><strong data-v-bc34ad5f>警告：</strong> 导入备份文件将会**彻底清空并覆盖**当前数据库中的所有数据！此操作不可逆，请在导入前确认您已备份好当前数据。 </p>',2)),e("div",sl,[e("input",{type:"file",onChange:m,accept:".json",ref_key:"fileInput",ref:c,class:"file-input"},null,544),e("button",{class:"btn btn-danger",onClick:w,disabled:!a.value||u.value},U(u.value?"正在导入...":"导入并覆盖"),9,ol)]),a.value?(g(),_("p",al," 已选择文件: "+U(a.value.name),1)):B("",!0),v.value?(g(),_("div",{key:1,class:I(["message",b.value])},U(v.value),3)):B("",!0)])]))}},ul=j(il,[["__scopeId","data-v-bc34ad5f"]]),dl={class:"settings-manage"},rl={class:"settings-card"},cl={class:"form-group"},vl={class:"form-group"},pl={class:"form-group"},ml={for:"bg_opacity"},gl={class:"form-group"},bl={class:"form-actions"},hl=["disabled"],fl={__name:"SiteSettings",setup(C){const s=p({bg_url_pc:"",bg_url_mobile:"",bg_opacity:.15,custom_css:"/* 自定义样式 */"}),u=p(!1),a=p(""),c=p("success");z(()=>y(null,null,function*(){u.value=!0;try{const b=yield ye();s.value=P(P({},s.value),b.data),s.value.bg_opacity=parseFloat(s.value.bg_opacity)}catch(b){a.value="加载设置失败: "+b.message,c.value="error"}finally{u.value=!1}}));function v(){return y(this,null,function*(){var b,d;u.value=!0,a.value="";try{const m=R(P({},s.value),{bg_opacity:String(s.value.bg_opacity)});yield Me(m),a.value="设置已成功保存！",c.value="success",setTimeout(()=>{a.value=""},3e3)}catch(m){a.value="保存失败: "+(((d=(b=m.response)==null?void 0:b.data)==null?void 0:d.error)||m.message),c.value="error",setTimeout(()=>{a.value=""},5e3)}finally{u.value=!1}})}return(b,d)=>(g(),_("div",dl,[e("div",rl,[d[11]||(d[11]=e("h2",{class:"card-title"},[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#2566d8","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m-8-4V7l8-4m0 14l8-4"})]),T(" 网站外观设置 ")],-1)),d[12]||(d[12]=e("p",{class:"card-desc"}," 在这里设置您网站的背景图、透明度和自定义CSS。 ",-1)),e("div",cl,[d[4]||(d[4]=e("label",{for:"bg_pc"},"电脑端 (PC) 背景图 URL",-1)),f(e("input",{id:"bg_pc","onUpdate:modelValue":d[0]||(d[0]=m=>s.value.bg_url_pc=m),placeholder:"https://example.com/pc_background.jpg",class:"input"},null,512),[[k,s.value.bg_url_pc]]),d[5]||(d[5]=e("p",{class:"input-hint"},"推荐横屏图片 (例如 1920x1080)。",-1))]),e("div",vl,[d[6]||(d[6]=e("label",{for:"bg_mobile"},"移动端背景图 URL",-1)),f(e("input",{id:"bg_mobile","onUpdate:modelValue":d[1]||(d[1]=m=>s.value.bg_url_mobile=m),placeholder:"https://example.com/mobile_background.jpg",class:"input"},null,512),[[k,s.value.bg_url_mobile]]),d[7]||(d[7]=e("p",{class:"input-hint"},"推荐竖屏图片 (例如 1080x1920)。如果留空，手机将使用默认背景图。",-1))]),e("div",pl,[e("label",ml," 背景蒙版透明度: "+U(Number(s.value.bg_opacity).toFixed(2)),1),f(e("input",{id:"bg_opacity",type:"range","onUpdate:modelValue":d[2]||(d[2]=m=>s.value.bg_opacity=m),min:"0.0",max:"1.0",step:"0.01",class:"slider"},null,512),[[k,s.value.bg_opacity,void 0,{number:!0}]]),d[8]||(d[8]=e("p",{class:"input-hint"},"值越大，背景图片越清晰，内容可能越难看清。",-1))]),e("div",gl,[d[9]||(d[9]=e("label",{for:"custom_css"},"自定义 CSS",-1)),f(e("textarea",{id:"custom_css","onUpdate:modelValue":d[3]||(d[3]=m=>s.value.custom_css=m),placeholder:`/* 您的自定义样式 */
body {
  /* 示例: 更改背景 */
  /* background-color: #f0f0f0 !important; */
}`,class:"input textarea",rows:"10"},null,512),[[k,s.value.custom_css]]),d[10]||(d[10]=e("p",{class:"input-hint"},"您在这里编写的CSS将被应用到网站的每一个页面。",-1))]),e("div",bl,[e("button",{class:"btn",onClick:v,disabled:u.value},U(u.value?"保存中...":"保存设置"),9,hl)]),a.value?(g(),_("div",{key:0,class:I(["message",c.value])},U(a.value),3)):B("",!0)])]))}},_l=j(fl,[["__scopeId","data-v-b231101c"]]),wl={key:0,class:"login-container"},kl={class:"login-card"},$l={class:"login-form"},yl={class:"password-input-wrapper"},Ml=["type"],Cl={key:0,width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"#2566d8","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ul={key:1,width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"#2566d8","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Vl={class:"login-buttons"},xl=["disabled"],Bl={key:0,class:"login-error"},Sl={key:1,class:"admin-layout"},Il={class:"menu-list"},Ll={class:"admin-main"},Al={class:"admin-header"},jl={class:"header-title"},Fl={class:"admin-content"},Tl={key:0,class:"welcome-page"},zl={class:"welcome-cards"},Pl={class:"welcome-card"},Hl={class:"welcome-value"},Rl={class:"welcome-card"},Nl={class:"welcome-value"},Dl={__name:"Admin",setup(C){const s=p("welcome"),u=p(""),a=p(""),c=p(!1),v=p(""),b=p(""),d=p(!1),m=p(""),w=p(!1),r=p(!1),t=q(()=>{switch(s.value){case"menu":return"栏目管理";case"card":return"卡片管理";case"ad":return"广告管理";case"friend":return"友链管理";case"user":return"用户管理";case"backup":return"数据备份与恢复";case"settings":return"网站外观设置";default:return""}});z(()=>{const h=localStorage.getItem("token");c.value=!!h,c.value&&l()});function l(){return y(this,null,function*(){try{const h=yield fetch("/api/users/me",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(h.ok){const n=yield h.json();u.value=n.last_login_time||"",a.value=n.last_login_ip||""}}catch(h){console.error("获取用户信息失败:",h)}})}function o(){return y(this,null,function*(){var h,n;if(!v.value||!b.value){m.value="请输入用户名和密码";return}d.value=!0,m.value="";try{const i=yield Ce(v.value,b.value);i.data.token&&(localStorage.setItem("token",i.data.token),c.value=!0,u.value=i.data.lastLoginTime||"",a.value=i.data.lastLoginIp||"")}catch(i){m.value=((n=(h=i.response)==null?void 0:h.data)==null?void 0:n.message)||"登录失败，请检查用户名和密码"}finally{d.value=!1}})}function x(){localStorage.removeItem("token"),c.value=!1,v.value="",b.value="",m.value=""}function $(){window.open("/","_blank")}function M(){r.value=!r.value}function S(){r.value=!1}return(h,n)=>c.value?(g(),_("div",Sl,[e("aside",{class:I(["admin-sider",{open:r.value}]),onClick:W(S,["self"])},[e("div",{class:"logo clickable",onClick:n[3]||(n[3]=i=>{s.value="welcome",S()})},"Admin"),e("ul",Il,[e("li",{class:I({active:s.value==="menu"}),onClick:n[4]||(n[4]=i=>{s.value="menu",S()})},"栏目管理",2),e("li",{class:I({active:s.value==="card"}),onClick:n[5]||(n[5]=i=>{s.value="card",S()})},"卡片管理",2),e("li",{class:I({active:s.value==="ad"}),onClick:n[6]||(n[6]=i=>{s.value="ad",S()})},"广告管理",2),e("li",{class:I({active:s.value==="friend"}),onClick:n[7]||(n[7]=i=>{s.value="friend",S()})},"友链管理",2),n[15]||(n[15]=e("li",{class:"menu-divider"},null,-1)),e("li",{class:I({active:s.value==="settings"}),onClick:n[8]||(n[8]=i=>{s.value="settings",S()})},"网站外观设置",2),e("li",{class:I({active:s.value==="backup"}),onClick:n[9]||(n[9]=i=>{s.value="backup",S()})},"数据备份与恢复",2),n[16]||(n[16]=e("li",{class:"menu-divider"},null,-1)),e("li",{class:I({active:s.value==="user"}),onClick:n[10]||(n[10]=i=>{s.value="user",S()})},"用户管理",2)])],2),e("main",Ll,[e("div",Al,[e("button",{class:"menu-toggle",onClick:M}," ☰ "),e("div",jl,U(t.value),1),e("div",{class:"header-actions"},[e("span",{class:"home-icon",onClick:$,title:"进入主页"},n[17]||(n[17]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[e("path",{d:"M3 10.5L12 4l9 6.5V20a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1v-4h-4v4a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V10.5z",stroke:"#2566d8","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])),e("button",{class:"btn logout-btn",onClick:x},"退出登录")])]),e("div",Fl,[s.value==="welcome"?(g(),_("div",Tl,[n[20]||(n[20]=e("h2",{class:"welcome-title"},"欢迎您进入 Nav-Item 后台管理系统",-1)),e("div",zl,[e("div",Pl,[n[18]||(n[18]=H('<div class="welcome-icon time-icon" data-v-5c1445bd><svg width="32" height="32" viewBox="0 0 24 24" fill="none" data-v-5c1445bd><circle cx="12" cy="12" r="10" stroke="#1abc9c" stroke-width="2" data-v-5c1445bd></circle><path d="M12 6v6l4 2" stroke="#1abc9c" stroke-width="2" stroke-linecap="round" data-v-5c1445bd></path></svg></div><div class="welcome-label" data-v-5c1445bd>上次登录时间</div>',2)),e("div",Hl,U(u.value||"--"),1)]),e("div",Rl,[n[19]||(n[19]=H('<div class="welcome-icon ip-icon" data-v-5c1445bd><svg width="32" height="32" viewBox="0 0 24 24" fill="none" data-v-5c1445bd><circle cx="12" cy="12" r="10" stroke="#1abc9c" stroke-width="2" data-v-5c1445bd></circle><path d="M12 8a4 4 0 1 1 0 8 4 4 0 0 1 0-8z" stroke="#1abc9c" stroke-width="2" data-v-5c1445bd></path><circle cx="12" cy="12" r="2" fill="#1abc9c" data-v-5c1445bd></circle></svg></div><div class="welcome-label" data-v-5c1445bd>上次登录IP</div>',2)),e("div",Nl,U(a.value||"--"),1)])])])):B("",!0),s.value==="menu"?(g(),F(Ye,{key:1})):B("",!0),s.value==="card"?(g(),F(bt,{key:2})):B("",!0),s.value==="ad"?(g(),F(Lt,{key:3})):B("",!0),s.value==="friend"?(g(),F(Dt,{key:4})):B("",!0),s.value==="user"?(g(),F(Zt,{key:5})):B("",!0),s.value==="backup"?(g(),F(ul,{key:6})):B("",!0),s.value==="settings"?(g(),F(_l,{key:7})):B("",!0)]),n[21]||(n[21]=e("footer",{class:"admin-footer"},[e("p",{class:"admin-copyright"},[T("Copyright © 2025 Nav-Item | "),e("a",{href:"https://github.com/eooce/Nav-Item",target:"_blank",class:"footer-link"},"Powered by eooce")])],-1))])])):(g(),_("div",wl,[e("div",kl,[n[14]||(n[14]=e("h2",{class:"login-title"},"后台管理登录",-1)),e("div",$l,[f(e("input",{"onUpdate:modelValue":n[0]||(n[0]=i=>v.value=i),type:"text",placeholder:"用户名",class:"login-input",onKeyup:K(o,["enter"])},null,544),[[k,v.value]]),e("div",yl,[f(e("input",{"onUpdate:modelValue":n[1]||(n[1]=i=>b.value=i),type:w.value?"text":"password",placeholder:"密码",class:"login-input password-input",onKeyup:K(o,["enter"])},null,40,Ml),[[ee,b.value]]),e("span",{class:"toggle-password",onClick:n[2]||(n[2]=i=>w.value=!w.value)},[w.value?(g(),_("svg",Cl,n[11]||(n[11]=[e("path",{d:"M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z"},null,-1),e("circle",{cx:"12",cy:"12",r:"3"},null,-1)]))):(g(),_("svg",Ul,n[12]||(n[12]=[e("path",{d:"M17.94 17.94A10.94 10.94 0 0 1 12 19c-7 0-11-7-11-7a21.77 21.77 0 0 1 5.06-6.06"},null,-1),e("path",{d:"M1 1l22 22"},null,-1),e("path",{d:"M9.53 9.53A3 3 0 0 0 12 15a3 3 0 0 0 2.47-5.47"},null,-1)])))])]),e("div",Vl,[e("button",{onClick:$,class:"back-btn"},n[13]||(n[13]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1),T(" 返回首页 ")])),e("button",{onClick:o,class:"login-btn",disabled:d.value},U(d.value?"登录中...":"登录"),9,xl)]),m.value?(g(),_("p",Bl,U(m.value),1)):B("",!0)])])]))}},ql=j(Dl,[["__scopeId","data-v-5c1445bd"]]);export{ql as default};
